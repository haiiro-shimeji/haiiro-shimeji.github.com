
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>ビルドツールGrunt.jsをPHP開発で利用する - My Octopress Blog</title>
  <meta name="author" content="Your Name">

  
  <meta name="description" content="通常、Webアプリケーション開発で使われる軽量プログラミング言語ではコンパイルが不要であるため、
Javaのmaven, Cのmakeに相当するようなビルドツールはこれまで利用されてきませんでした。
しかし、近年のWebアプリケーション開発ではデプロイ時に開発リソースに対して以下のような前処理が &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://haiiro-shimeji.github.com/blog/2015/07/20/grunt-php/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="My Octopress Blog" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">My Octopress Blog</a></h1>
  
    <h2>A blogging framework for hackers.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:haiiro-shimeji.github.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">ビルドツールGrunt.jsをPHP開発で利用する</h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-07-20T00:00:00+09:00" pubdate data-updated="true">Jul 20<span>th</span>, 2015</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>通常、Webアプリケーション開発で使われる軽量プログラミング言語ではコンパイルが不要であるため、
Javaのmaven, Cのmakeに相当するようなビルドツールはこれまで利用されてきませんでした。<br/>
しかし、近年のWebアプリケーション開発ではデプロイ時に開発リソースに対して以下のような前処理が
行われることが増えてきたため、これらの作業の自動化、共有化の目的でビルドツールが利用されるように
なってきています。</p>

<ul>
<li>外部ライブラリの依存関係解決とアプリケーションへの組み込み</li>
<li>Javascript, CSSのminify</li>
<li>Sass, CompassなどのCSS出力スクリプトのコンパイル</li>
<li>リソースURLの難読化</li>
</ul>


<p>加えて、継続的インテグレーション(CI)のための次のような機能も提供されます。</p>

<ul>
<li>デバッグサーバーの起動</li>
<li>ファイル保存時の構文チェックやコード規約チェック自動化</li>
<li>ファイル保存時のテスト自動化</li>
</ul>


<p>このエントリでは、Webフロントエンド開発(Javascript開発)で広く利用されているビルドツールである
GruntをPHPのバックエンド開発まで含めて利用する例を記載します。</p>

<h1>YeomanによるPHPアプリケーションプロジェクトサンプルの作成</h1>

<p>Yeomanは、Gruntプロジェクトのテンプレートを作成するツールです。<br/>
作業を始める前に、まずはYeomanとGruntのインストールを行います。npmが利用できる環境で、</p>

<pre><code># npm install -g yo grunt-cli bower
</code></pre>

<p>としてください。</p>

<p>また、phpプロジェクトテンプレートのインストールを行います。これは一般に公開されているものがあるのですが、
メンテナンスが停止していて微妙な感じだったので、社内リポジトリに修正拡張したものを配置しました。
こちらをインストールしてみてください。</p>

<pre><code># npm install -g http://192.168.142.11:8080/ikeda_shoichi/generator-php
</code></pre>

<p>上記ツール類がインストールできたら、プロジェクトを作成します。</p>

<pre><code>$ mkdir php-sample
$ cd php-sample
$ yo php

     _-----_
    |       |
    |--(o)--|   .--------------------------.
   `---------´  |    Welcome to Yeoman,    |
    ( _´U`_ )   |   ladies and gentlemen!  |
    /___A___\   '__________________________'
     |  ~  |
   __'.___.'__
 ´   `  |° ´ Y `

I'll be scaffolding out a php website for you.
Out of the box you're going to get:
- HTML5 Boilerplate
- jQuery (v1.11)
- Modernizr (v2.8.3)
[?] What's the production URL for this site? hoge.example.com
[?] and the dev URL? 127.0.0.1
[?] What port should I use for the dev URL? 50080
[?] Use PHP's built-in web server for dev testing? Yes
[?] Which CSS preprocessor shall I use (none, sass, compass)? compass
[?] Which version of Twitter Bootstrap shall I include (none, 2.3.2, 3.3.5, etc)? 3.3.5
[?] Include Foundation Framework (v3)? No
[?] Which files should be versioned to force cache expiration (none, all, css, js, img)? all
[?] What name should I give the application directory where your development files are placed? app
[?] What name should I give the distribution directory where compiled output files are placed? dist
</code></pre>

<p>yoコマンドを実行すると、怪しげな紳士のAAの表示とともに、プロジェクト作成に必要ないくつかの質問をされます。</p>

<p>What's the production URL for this site?
: 作成されるWebサイトのURLです。</p>

<p>and the dev URL?
: デバッグサーバー立ち上げの際のURLを聞かれます。<br/>
ローカルホストで立ち上げる場合はループバックアドレスを入力すればよいですが、開発サーバーなどで立ち上げる場合は
そのプライベートアドレスとかにするべきです。</p>

<p>What port should I use for the dev URL?
: デバッグサーバーのポートを指定します。他のプログラムで使用されていないポートを指定する必要があります。</p>

<p>Use PHP's built-in web server for dev testing?
: デバッグサーバーにPHPビルドインサーバーを利用するかどうかを指定します。デフォルトでは利用しないということになっていますが、
Yesを選択します。</p>

<p>Which CSS preprocessor shall I use (none, sass, compass)?
: CSS preprocessor scriptを選択します。sassはyeomanテンプレートのバグでなんだか使えないので、compassを選択します。
ちなみにCSS preprocessor を使っていても、通常のCSSと同じように記述していればそのままCSSとして出力されます。</p>

<p>Which version of Twitter Bootstrap shall I include (none, 2.3.2, 3.3.5, etc)?
: Twitter Bootstrapを利用するかどうかと、バージョンを指定します。プロジェクトごとに任意に選択してください。</p>

<p>Include Foundation Framework (v3)?
: Foudation Frameworkを利用するかどうかを指定します。私も使ったことがないのでNoを指定しています。</p>

<p>Which files should be versioned to force cache expiration (none, all, css, js, img)?
: ブラウザのキャッシュ機能で古いリソースがユーザーに利用され続けたりすることを防いだり、URLの法則性から
画像リソースを予測してアクセスされるのを防ぐために、リソースURLの難読化を行うかどうかを指定します。
allを選択します。</p>

<p>What name should I give the application directory where your development files are placed?
: アプリケーションプログラムの配置ディレクトリを指定します。特に問題がなければデフォルトのappを指定します。</p>

<p>What name should I give the distribution directory where compiled output files are placed?
: ビルド済みプログラムの配置ディレクトリを指定します。特に問題がなければデフォルトのdistを指定します。</p>

<p>これらを入力すると、npmで必要な依存ライブラリなどのダウンロードがはじまり、
しばらく待っているとプロジェクトテンプレートが作成されます。</p>

<h1>Gruntプロジェクトの利用方法</h1>

<h2>ビルド</h2>

<pre><code>$ grunt
</code></pre>

<p>とりあえず、おもむろにgruntコマンドを実行すればビルドが開始されます。<br/>
しかし、ビルドの過程で行われるJavascriptのユニットテストがひとつもテストが無い状態だと失敗扱いになるので、
とりあえずビルドを完遂するために、ここは</p>

<pre><code>$ grunt --force
</code></pre>

<p>としてください。あるいは、テストプロセスをスキップしてビルドだけを行うには</p>

<pre><code>$ grunt build
</code></pre>

<p>とします。<br/>
テストの作成、配置の方法は後述します。</p>

<p>このプロジェクトにおいてビルドの過程で行う処理は、以下のものになります。</p>

<ul>
<li>Javascript Syntax check</li>
<li>PHP Syntax check</li>
<li>PHP ライブラリ依存関係の解決(composer)</li>
<li>Javascript ユニットテスト実行</li>
<li>PHP ユニットテスト実行</li>
<li>compassのコンパイル</li>
<li>html圧縮</li>
<li>CSS3ベンダー互換記述の整理(autoprefix)</li>
<li>CSS圧縮</li>
<li>Javasctript圧縮</li>
<li>リソースURLの難読化、参照箇所のURL置換</li>
</ul>


<h2>デバッグサーバーの立ち上げ</h2>

<pre><code>$ grunt server
</code></pre>

<p>上記コマンドで、php ビルドインサーバーが起動しデバッグサーバーが立ち上がります。<br/>
デバッグサーバーのポートはプロジェクト作成時に指定したものが使われるので、
サーバー立ち上げ前にこのポートが未使用であることを確認してください。</p>

<p>デバッグサーバーは、ローカルのファイルを監視し、変更があった時自動でページの
再読み込みを行ったり、compassのコンパイル、javascriptのシンタックスチェック、
ユニットテストの実行などを行います。</p>

<h2>ユニットテスト</h2>

<p>ユニットテストを実行するには、以下のコマンドを実行します。</p>

<pre><code>$ grunt test:continuous
</code></pre>

<p>テストはJavascriptとPHPについて配置されているテストをすべて実行します。</p>

<h3>Javascript</h3>

<p>Javascriptのテストフレームワークにはkarmaを使っています。<br/>
test/js/spec/ 以下にテストファイルを配置してください。</p>

<p>```javascript</p>

<pre><code>'use strict';

describe('test for someMethod', function() {
    it('someMethod returns true', function() {
        expect(someMethod()).toBe(true);
    });
});
</code></pre>

<p>```</p>

<h3>PHP</h3>

<p>PHPのテストフレームワークはphpunitを使っています。<br/>
test/php/classes/ 以下にテストファイルを配置してください。</p>

<p>```PHP</p>

<pre><code>&lt;?php
class StackTest extends PHPUnit_Framework_TestCase
{
    public function testPushAndPop()
    {
        $stack = array();
        $this-&gt;assertEquals(0, count($stack));

        array_push($stack, 'foo');
        $this-&gt;assertEquals('foo', $stack[count($stack)-1]);
        $this-&gt;assertEquals(1, count($stack));

        $this-&gt;assertEquals('foo', array_pop($stack));
        $this-&gt;assertEquals(0, count($stack));
    }
}
</code></pre>

<p>```</p>

<h1>まとめ</h1>

<p>Webのフロントエンド開発でよく用いられるビルドツールであるGruntを使って、
バックエンド側のPHPプログラムのビルドや開発ツールも利用する手順を紹介しました。<br/>
これにより、フロントエンド側とバックエンド側のビルド処理を統一的に扱うことが
可能になり、ビルド処理の見通しをわかりやすく管理することができます。</p>

<p>Gruntをはじめとするビルドツールの多くは、プラグイン方式を採用しており、
ビルド処理を管理するビルドツールと個々のビルド処理は独立した開発が行われています。</p>

<p>開発者は自分が必要だと思う処理を選択または自分で作成して、ビルドに含めることができます。<br/>
すべてのビルド処理を自分で選択するというのはなかなか大変なので、Yeomanという
プロジェクトテンプレートツールを併用することで、一般的に必要と思われるビルド処理を簡単に
構築することが出来ます。</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Your Name</span></span>

      








  


<time datetime="2015-07-20T00:00:00+09:00" pubdate data-updated="true">Jul 20<span>th</span>, 2015</time>
      


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://haiiro-shimeji.github.com/blog/2015/07/20/grunt-php/" data-via="" data-counturl="http://haiiro-shimeji.github.com/blog/2015/07/20/grunt-php/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2015/07/07/phonegap/" title="Previous Post: Cordovaからハードウェア機能を利用する">&laquo; Cordovaからハードウェア機能を利用する</a>
      
      
        <a class="basic-alignment right" href="/blog/2015/08/12/autoprefixer/" title="Next Post: CSS3のクロスブラウザサポートを支援するAutoprefixer">CSS3のクロスブラウザサポートを支援するAutoprefixer &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2015/09/04/git-branch/">Git Branch</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/09/02/git-flow/">gitのブランチ運用とgit flow</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/08/12/autoprefixer/">CSS3のクロスブラウザサポートを支援するAutoprefixer</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/07/20/grunt-php/">ビルドツールGrunt.jsをPHP開発で利用する</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/07/07/phonegap/">Cordovaからハードウェア機能を利用する</a>
      </li>
    
  </ul>
</section>






  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - Your Name -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
