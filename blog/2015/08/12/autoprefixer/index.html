
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>CSS3のクロスブラウザサポートを支援するAutoprefixer - My Octopress Blog</title>
  <meta name="author" content="Your Name">

  
  <meta name="description" content="AutoprefixerはCSS3のベンダ互換プレフィックスの管理をしてくれるツールです。
ベンダープレフィックスというのは、CSS3が勧告される前に各ブラウザが独自に該当機能を
実装していた時代に、記述の衝突を避けるためにプロパティ名に付加されて使用されていたプレフィックスです。 たとえば、 &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://haiiro-shimeji.github.com/blog/2015/08/12/autoprefixer/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="My Octopress Blog" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">My Octopress Blog</a></h1>
  
    <h2>A blogging framework for hackers.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:haiiro-shimeji.github.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">CSS3のクロスブラウザサポートを支援するAutoprefixer</h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-08-12T00:00:00+09:00" pubdate data-updated="true">Aug 12<span>th</span>, 2015</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>AutoprefixerはCSS3のベンダ互換プレフィックスの管理をしてくれるツールです。<br/>
ベンダープレフィックスというのは、CSS3が勧告される前に各ブラウザが独自に該当機能を
実装していた時代に、記述の衝突を避けるためにプロパティ名に付加されて使用されていたプレフィックスです。</p>

<p>たとえば、border-imageは、昔はFirefoxでは</p>

<p>```CSS</p>

<pre><code>-moz-border-image: url("bg_dot.png") 15 round;
</code></pre>

<p>```</p>

<p>Chrome, Safariでは</p>

<p>```CSS</p>

<pre><code>-webkit-border-image: url("bg_dot.png") 15 round;
</code></pre>

<p>```</p>

<p>でした。結構昔の話なので、いつまでこうだったのかは覚えてないです。</p>

<p>ベンダプレフィックスは、各プロパティがCSS3勧告として正式採用されれば必要なくなるはずですが、<br/>
CSS3勧告は段階的に行われているので、今後もベンダープレフィックスが必要なプロパティが発生する
可能性はあります。(実際にはなさそうらしいですが…)<br/>
あと、ユーザーが古いバージョンのブラウザを使っている場合には未だにベンダープレフィックス付きの
CSSを作成する必要があります。</p>

<p>各ブラウザ、各バージョンでのCSSプロパティの対応状況(ベンダープレフィックスの必要有無も含む)は、
http://caniuse.com/ でまとめられているので、妖しげなプロパティを使う場合には確認するといいと思います。</p>

<h2>Autoprefixer</h2>

<p>さて、そんなベンダープレフィックスですが、各プロパティについてサポート対象とするブラウザが対応しているのかどうか、
を記憶しておくほど暇ではないですし、いちいち http://caniuse.com/ まで確認しにいくというのは面倒です。</p>

<p>ここで登場するのが、Autoprefixerです。</p>

<p>Autoprefixerは、CSSファイルを読み込み、記述内容をcaniuseの情報と照らしあわせて、必要あれば
ベンダープレフィックスを付けてCSSを出力してくれるという便利ツールです。<br/>
公式のgithubのREADMEによると、caniuseの最新の情報を参照して変換処理を行う、と書いてあります。<br/>
コマンドを実行するたびに最新情報を取得しに行くのか、ツールのアップデートのタイミングで情報更新を
行うのかは調べていません。</p>

<p>インストールには npm が必要です。</p>

<pre><code># npm install --global postcss-cli autoprefixer
</code></pre>

<p>そして、こんなCSSを書いてみます。</p>

<p>```CSS</p>

<pre><code>a {
    display: flex;
}
</code></pre>

<p>```</p>

<p>aptoprefixerで変換してみます。</p>

<pre><code>$ postcss --use autoprefixer main.css -o main.dist.css
</code></pre>

<p>すると、こんなCSSが吐き出されます。</p>

<p>```CSS</p>

<pre><code>a {
    display: -webkit-box;
    display: -webkit-flex;
    display: -ms-flexbox;
    display: flex;
}
</code></pre>

<p>```</p>

<p>MozillaやWebkitのプレフィクスが自動で付加されました。</p>

<p>また、元のCSSに現在では不要なベンダープレフィックスが記述されている場合にそれを除去してくれる機能もあります。</p>

<p>```CSS</p>

<pre><code>a {
    -webkit-border-radius: 5px;
        border-radius: 5px;
}
</code></pre>

<p>```</p>

<p>という入力を与えると、実際には現在のWebkitエンジンではborder-radiusのベンダープレフィックスは不要なので、</p>

<p>```CSS</p>

<pre><code>a {
    border-radius: 5px;
}
</code></pre>

<p>```</p>

<p>となります。</p>

<p>実際には、複数のCSSを一括変換する必要があると思います。そのためには下記のようにします。</p>

<pre><code>$ postcss --use autoprefixer src/css/*.css -d dest/css
</code></pre>

<h3>サポートブラウザの指定</h3>

<p>上記の例では、デフォルトのサポートブラウザ指定を使いました。<br/>
実際にはプロジェクトごとにサポートするブラウザが決まっていると思います。<br/>
ブラウザバージョンの明示指定は以下のようにします。</p>

<pre><code>$ postcss --use autoprefixer \
--autoprefixer.browsers 'last 2 firefox versions, last 2 chrome versions, ie 10, ie 11' \
main.css -o main.dist.css
</code></pre>

<p>この指定では、Firefoxの最新の2バージョン、Chromeの最新の2バージョン、IE 10, 11をサポートするために
ベンダープレフィックスを付加するように指示しています。<br/>
上記の flex のプロパティが使われているCSSを入力すると、出力されるCSSは以下のようになります。</p>

<p>```CSS</p>

<pre><code>a {
    display: -ms-flexbox;
    display: flex;
}
</code></pre>

<p>```</p>

<p>caniuseの記述によると、上記指定のブラウザの中でベンダープレフィックスが必要なのは、IE10のみです。<br/>
http://caniuse.com/#feat=flexbox<br/>
ブラウザの指定が出力結果に反映されていることがわかります。</p>

<h3>サポートブラウザの自動指定</h3>

<p>と、ここまでだと、ふーんAutoprefixerやるじゃんすごいじゃん、という感じなのですが、さらにAutoprefixerには
サポートブラウザの自動選択の機能があるので、紹介しておきます。</p>

<p>autoprefixerコマンドに -i オプションを付加して実行すると、任意のブラウザ指定でどのブラウザがサポートされるのかと、
その指定の場合に必要とされるベンダープレフィックスの一覧が表示されます。</p>

<p>````</p>

<pre><code>$ autoprefixer -i -b 'last 2 firefox version, last 2 chrome versions, ie 10, ie 11'
Autoprefixer CLI is deprecated. Use postcss-cli instead.
Browsers:
  Chrome: 44, 43
  Firefox: 39, 38
  IE: 11, 10

...
この下には、これらのブラウザで必要なベンダープレフィックスの一覧が表示されます
</code></pre>

<p>````</p>

<p>最初の例では、明示的なブラウザ指定を行わずデフォルトの設定を使いました。<br/>
この時にサポートに入ったブラウザは何だったのでしょうか。 -b オプションなしで実行してみます。</p>

<p>````</p>

<pre><code>$ autoprefixer -i
Autoprefixer CLI is deprecated. Use postcss-cli instead.
Browsers:
  Chrome for Android: 42
  UC for Android: 9.9
  Android: 4.4, 4.4.3-4.4.4, 4.2-4.3
  Chrome: 44, 43
  Firefox: 39, 38, 31
  IE: 11, 10, 9, 8
  IE Mobile: 11, 10
  iOS: 8.1-8.4, 8
  Opera Mini: 5.0-8.0
  Opera: 30, 29, 12.1
  Safari: 8, 7.1
</code></pre>

<p>````</p>

<p>かなり多くのブラウザを対象としています。</p>

<p>ブラウザの明示指定がない場合、デフォルトでどのブラウザをサポートするのかは、
autoprefixerのサポートモジュールである browserlist のドキュメントに記載があります。</p>

<p>https://github.com/ai/browserslist</p>

<p>これによると、デフォルトのブラウザ指定は以下のようになっている、とあります。</p>

<pre><code>&gt; 1%, last 2 versions, Firefox ESR, Opera 12.1
</code></pre>

<p>カンマ区切りで複数の条件が指定されています。</p>

<p>|> 1%|主要ブラウザのうち、ユーザーシェアが1%以上のブラウザとそのバージョンを指定します|
|last 2 versions|主要ブラウザのうち、最新の2バージョンを指定します|
|Firefox ESR|Firefoxの法人向けサポート版です|
|Opera 12.1|Opera Presto版の最新バージョンです|</p>

<p>「主要ブラウザ」というのは、 Chrome, Firefox, IE, IE Mobile, iOS Safari, Opera, Safari を指します。<br/>
面白いのは、最初のシェア割合の指定で、古いブラウザでも何らかの事情で利用が停止されていないものは
自動的にサポート対象に含められることになります。<br/>
Androidの旧ブラウザなんかは、ベンダの改造OSがアップデート出来ない影響で使い続けている人が
少数だがまだいる、ということのようです。<br/>
IE8はシェア2%指定にすると消えますが、まだ少し使ってる人がいるということのようですね。XPでしょうか。</p>

<p>国別シェアの指定を行うことも出来ます。アメリカで2％以上のシェアがあるブラウザを指定するには、以下のようにします。</p>

<pre><code>$ autoprefixer -i -b "&gt; 2% in US"
Autoprefixer CLI is deprecated. Use postcss-cli instead.
Browsers:
  Chrome for Android: 0
  Chrome: 44, 43
  Firefox: 39, 38
  IE: 11
  iOS: 8.1-8.4
  Safari: 8
</code></pre>

<p>対して、日本で2％以上のシェアがあるブラウザを指定するには、以下のようにします。</p>

<pre><code>$ autoprefixer -i -b "&gt; 2% in JP"
Autoprefixer CLI is deprecated. Use postcss-cli instead.
Browsers:
  Chrome for Android: 0
  Android: 4.4
  Chrome: 44, 43
  Firefox: 39
  IE: 11, 9
  iOS: 8.1-8.4
</code></pre>

<p>日本だとアメリカに比べてIE9のシェアが多いです。Vistaでしょうか。7をアップデートしないまま使ってるユーザーでしょうか。<br/>
あと、Android4.4ブラウザは日本のベンダーカスタマイズAndroidのせいだと思います。<br/>
まあブラウザシェア自体は調べればすぐにわかるのですが、CSSの調整に直接適用してしまおうというのが面白いと思います。</p>

<p>というわけで、autoprefixerを使うことで、将来的なブラウザのアップデートや、シェアの変化に対応した
最適なCSSを自動的に作成できる、ということになります。</p>

<h3>Gruntからの利用</h3>

<p>Autoprefixerの処理をGruntのビルド処理に含めることが出来ます。<br/>
ここまでの例では色々試したかったのでコマンドラインで使いましたが、ビルドプロセスに含めて自動で処理するほうが
一般的だと思います。</p>

<p>Gruntfile.js に以下を記述</p>

<p>```Javascript</p>

<pre><code>autoprefixer: {
    options: {
        browsers: ['last 2 version', 'ie 8', 'ie 9']
    },
    file: {
        expand: true,
        flatten: true,
        src: 'src/css/*.css',
        dest: 'dest/css/'
    },
}
</code></pre>

<p>```</p>

<p>ぐぐるといっぱい出てくると思うので、詳細は割愛します。</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Your Name</span></span>

      








  


<time datetime="2015-08-12T00:00:00+09:00" pubdate data-updated="true">Aug 12<span>th</span>, 2015</time>
      


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://haiiro-shimeji.github.com/blog/2015/08/12/autoprefixer/" data-via="" data-counturl="http://haiiro-shimeji.github.com/blog/2015/08/12/autoprefixer/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2015/07/20/grunt-php/" title="Previous Post: ビルドツールGrunt.jsをPHP開発で利用する">&laquo; ビルドツールGrunt.jsをPHP開発で利用する</a>
      
      
        <a class="basic-alignment right" href="/blog/2015/09/02/git-flow/" title="Next Post: gitのブランチ運用とgit flow">gitのブランチ運用とgit flow &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2015/09/04/git-branch/">Git Branch</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/09/02/git-flow/">gitのブランチ運用とgit flow</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/08/12/autoprefixer/">CSS3のクロスブラウザサポートを支援するAutoprefixer</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/07/20/grunt-php/">ビルドツールGrunt.jsをPHP開発で利用する</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/07/07/phonegap/">Cordovaからハードウェア機能を利用する</a>
      </li>
    
  </ul>
</section>






  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - Your Name -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
