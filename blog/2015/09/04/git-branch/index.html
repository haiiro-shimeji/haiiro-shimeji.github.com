<p>ここからは、現実の開発で発生しがちなケースとその対応を検討してみます。</p>

<h2>1.x-betaデバッグ中にリリースに含めるべき機能が追加される</h2>

<pre><code>「ねえねえ、今度リリース予定のバージョンなんだけど、作成中の○○の機能は入るの？」  
「いや、その機能は次のリリースで追加される予定ですが」  
「ええっ困るよ！まだデバッグ始まったばかりでしょ？今から○○も入れてリリースしてよ」  
「」
</code></pre>

<p>まだ1.xデバッグ中ということで、1.(x+1)は開発初期という可能性が高いです。</p>

<p>もし、該当のフィーチャーブランチがまだdevelopにマージされていなければ、フィーチャーブランチの開発が終わったら、developにマージせずに即時releaseにマージしてしまいましょう。すでにdevelopにマージ済みという場合は、上述のようにマージ段階のフィーチャーブランチの先頭コミットを調べて、それをreleaseにマージします。</p>

<pre><code>$ git log develop

commit e3d4e28365998b0d5f58b4e6c7b8f7e5cc68349e
Merge: 3804264 a1d81d8
Author: ikeda.shoichi &lt;ikeda.shoichi@localhost&gt;
Date:   2015-09-02 14:09:22 +0900

    Merge branch 'newFeatureA' into develop

$ git checkout release
$ git merge a1d81d8 --no-ff
</code></pre>

<p>その後、releaseをdevelopにマージします。該当機能に関するバグフィックスなどが発生したら、他のreleaseで修正されるバグと同様に、releaseにコミットしてdevelopにマージします。</p>

<p>1.(x+1)が開発初期ということで、フィーチャーブランチをreleaseにマージする際に衝突は発生しない場合が多いでしょう。しないといいですね。衝突してしまった場合はかなり面倒な作業でコミットの切り分けをする必要があります。本質的には次項と同じなので、そちらを参照してください。</p>

<h2>当初予定されていた機能を削ったバージョンを前倒しでリリースすることになった</h2>

<pre><code>「ねえねえ、○○の機能が入る次のバージョンっていつリリースなの？」  
「△月の予定ですが」  
「遠いなあ…○○をすぐに使いたいっていうお客さんがいるから、○○だけ入れて前倒しでリリースしてよ」  
「」
</code></pre>

<p>ほとんど最悪な状況なのですが、実際にはよく起こります。世の中の人は、機能どうしの依存関係などは考慮に入れることなく、単純な足し算引き算で機能の着脱、納期の伸縮が可能であると思っています。</p>

<p>バージョン1.xとして複数の機能を開発している途中で、そのなかのひとつだけを実装に含めてreleaseブランチを作成し、リリース作業を開始することになります。</p>

<p>まず、前回リリース時のreleaseブランチを復活させ、次回リリースに使うreleaseブランチとします。前回リリース時のreleaseブランチは、masterへのマージログから参照することが出来ます。</p>

<pre><code>$ git log master
commit 017a9a034d8d2be74a72563b69e370ee9188bb26
Merge: ec2ecd9 da06717
Author: ikeda.shoichi &lt;ikeda.shoichi@localhost&gt;
Date:   2015-09-02 06:01:59 +0900

    Merge branch 'release' into master

$ git checkout da06717
$ git checkout -b release
</code></pre>

<p>そこに該当機能のフィーチャーブランチをマージして新しいバージョンのリリース作業を開始します。<br/>
マージ時に運良く衝突が発生しなければラッキーですが、衝突してしまった場合は、developブランチ上で該当のフィーチャーブランチがマージされるまでの間にされたコミットのうち、このブランチが依存するものだけを選択してreleaseブランチにcherry-pickしていく必要があります。ここまでの開発で、適切なコミット粒度を維持できていたかが問われます。releaseに首尾よくマージできても、developに再度マージする際にも多分衝突が発生します。あきらめずにがんばりましょう。</p>

<h2>後方互換性の無いバージョン2.0の開発と1.xの開発に分化する</h2>

<p>「ねえねえ、次のバージョンではP○P 5.1のサポートを切るって聞いたけど」
「はい、もうセキュリティ上の理由で古いバージョンは使われないと判断しました。その場合、古いバージョンで許される記述のみで開発を続けるのは、開発コスト的にも高くなるので」
「お客さんのサーバーで、事情があってP○Pのバージョンを上げられないところがあって、古いバージョンでも動く形で、バグフィックスとかだけ適用していって欲しいんだけど」
「」</p>
